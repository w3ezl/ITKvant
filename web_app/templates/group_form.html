<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Создание группы</title>
    <link rel="stylesheet" type="text/css" href="{{ static_versioned('style/main.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="icon" type="image/png" href="{{ static_versioned('img/favicon.png') }}" />
</head>
<body>
    <div class="header">
        <div class="header_btns main_menu_btns">
            <a href="/dashboard?page=admin&select=groups">Панель управления</a>
        </div>
        <a href="/profile/{{ current_user.id }}">
            <div class="header_profile">
                <img src="{{ static_versioned('uploads/avatars/'+current_user.id|string+'.png') }}">
                <p>
                    {{ current_user.last_name }}<br>
                    {{ current_user.first_name }}
                </p>
            </div>
        </a>
        <div class="profile_menu">
            <a href="/logout">Выйти</a>
        </div>

        <script>
        $(function() {
            let $profile = $(".header_profile");
            let $menu = $(".profile_menu");
            let timeout;

            function showMenu() {
                clearTimeout(timeout);
                $menu.stop(true, true).fadeIn(200);
            }

            function hideMenu() {
                timeout = setTimeout(function() {
                    $menu.stop(true, true).fadeOut(200);
                }, 200);
            }

            $profile.on("mouseenter", showMenu);
            $profile.on("mouseleave", hideMenu);

            $menu.on("mouseenter", showMenu);
            $menu.on("mouseleave", hideMenu);
        });
        </script>
    </div>
    <div class="main">
        <div class="main_form">
            <form method="post" action="{% if group.name %}/group?id={{group.id}}{% else %}/group{% endif %}">
            <div class="flex_container">
                <div class="col_block w40">
                    <label>Название</label>
                    <input type="text" name="name" placeholder="ИТ 2-3" value="{{ group.name }}" required>
                </div>
                <div class="col_block w20">
                    <label>Год</label>
                    <input type="number" name="year" placeholder="2" value="{{ group.study_year }}" required>
                </div>
                <div class="col_block w40">
                    <label>Учитель</label>
                    <select name="teacher" required>
                        {% for teacher in teachers %}
                            <option value="{{ teacher.id }}" {% if teacher == group.teacher %}selected{% endif %}>{{ teacher.first_name }} {{ teacher.father_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="schedule-wrapper">
              <table class="schedule-table">
                <thead>
                  <tr>
                    <th>Время</th>
                    <th>Пн</th>
                    <th>Вт</th>
                    <th>Ср</th>
                    <th>Чт</th>
                    <th>Пт</th>
                    <th>Сб</th>
                    <th>Вс</th>
                  </tr>
                </thead>
                <tbody>
                  {% set days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
                  {% set times = ["10:00-11:30", "12:00-13:30", "14:00-15:30", "15:00-16:30", "16:30-18:00", "18:20-19:50"] %}

                  {% for time in times %}
                  <tr>
                    <td>{{ time }}</td>
                    {% for day in days %}
                      <td>
                        <input type="checkbox"
                               name="schedule_{{ day }}"
                               value="{{ time }}"
                               {% if group.schedule and day in group.schedule and time in group.schedule[day] %}checked{% endif %}>
                      </td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <input type="submit" value="{% if group.name %}Обновить{% else %}Создать{% endif %}">
            </form>
        </div>
    </div>
    <script>
        $(".schedule-table td").has("input[type='checkbox']").hover(
            function() {
                const cell = $(this);
                const colIndex = cell.index();
                const row = cell.closest("tr");

                row.closest("table").find("thead th").eq(colIndex).addClass("highlight");

                row.find("td").first().addClass("highlight");
            },
            function() {
                $(".schedule-table td, .schedule-table th").removeClass("highlight");
            }
        );
    </script>
</body>
</html>